<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMwithAI Demo Store - Home</title>
  <link rel="stylesheet" href="styles.css">
<!-- Google tag (gtag.js) -->
<script>
  /* === CONFIG (generated) === */
  const COLLECTOR_BASE = "https://dmwithai.selftrainai.com/api/collector";
  const TENANT_ID = "2";
  const SITE_TOKEN = "icE56lQxxTWOwTR8dntpNkj-I-Vrxl0-";

  function sid() {
    const k = "_our_sid"; let v = sessionStorage.getItem(k);
    if (!v) { v = Math.random().toString(36).slice(2)+Date.now().toString(36); sessionStorage.setItem(k, v); }
    return v;
  }
  function getParams() {
    const sp = new URLSearchParams(location.search);
    const g = k => sp.get(k) || undefined;
    
    // Debug: log current URL
    console.log('ðŸ” Current URL:', location.href);
    console.log('ðŸ” URL search params:', location.search);
    
    // Get UTM params from current URL
    const currentUtm = {
      source: g('utm_source'),
      medium: g('utm_medium'),
      campaign: g('utm_campaign'),
      term: g('utm_term'),
      content: g('utm_content')
    };
    const currentClid = {
      gclid: g('gclid'),
      fbclid: g('fbclid'),
      ttclid: g('ttclid')
    };
    
    // Filter out undefined values
    const cleanUtm = {};
    const cleanClid = {};
    Object.keys(currentUtm).forEach(k => { if (currentUtm[k]) cleanUtm[k] = currentUtm[k]; });
    Object.keys(currentClid).forEach(k => { if (currentClid[k]) cleanClid[k] = currentClid[k]; });
    
    // Check if current URL has UTM params
    const hasCurrentUtm = Object.keys(cleanUtm).length > 0;
    const hasCurrentClid = Object.keys(cleanClid).length > 0;
    
    // If current URL has UTM params, save them to sessionStorage
    if (hasCurrentUtm || hasCurrentClid) {
      try {
        const toStore = { utm: cleanUtm, clid: cleanClid };
        sessionStorage.setItem('_utm_params', JSON.stringify(toStore));
        console.log('ðŸ” UTM saved to sessionStorage:', toStore);
      } catch(e) {
        console.error('Failed to save UTM to sessionStorage:', e);
      }
      return { utm: cleanUtm, clid: cleanClid };
    }
    
    // Otherwise, try to restore from sessionStorage
    try {
      const stored = sessionStorage.getItem('_utm_params');
      if (stored) {
        const parsed = JSON.parse(stored);
        const restoredUtm = parsed.utm || {};
        const restoredClid = parsed.clid || {};
        // Check if restored params have actual values
        const hasRestoredUtm = Object.keys(restoredUtm).length > 0;
        const hasRestoredClid = Object.keys(restoredClid).length > 0;
        if (hasRestoredUtm || hasRestoredClid) {
          console.log('ðŸ” UTM restored from sessionStorage:', { utm: restoredUtm, clid: restoredClid });
          return { utm: restoredUtm, clid: restoredClid };
        }
      }
    } catch(e) {
      console.error('Failed to restore UTM from sessionStorage:', e);
    }
    
    // Fallback: no UTM params
    console.log('ðŸ” No UTM params found (current URL or sessionStorage)');
    return { utm: {}, clid: {} };
  }
  function sendEvent(type, extra = {}) {
    const payload = { t:type, tenantId:TENANT_ID, siteToken:SITE_TOKEN, url:location.href, ref:document.referrer||null, sid:sid(), ...getParams(), ...extra };
    const body = JSON.stringify(payload);
    if (navigator.sendBeacon) {
      navigator.sendBeacon(`${COLLECTOR_BASE}/collect`, new Blob([body], { type: 'text/plain;charset=UTF-8' }));
      return;
    }
    fetch(`${COLLECTOR_BASE}/collect`, {
      method:'POST',
      headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
      body,
      keepalive:true
    }).catch(()=>{});
  }
  sendEvent('pageview');
  (function(){
    let engaged=false;
    const markEngaged=()=>{ if(engaged) return; engaged=true; sendEvent('engaged'); };
    const markBounce =()=>{ if(engaged) return; sendEvent('bounce'); };
    setTimeout(markEngaged, 30_000);
    window.addEventListener('scroll', ()=>{ const s=(window.scrollY+window.innerHeight)/(document.documentElement.scrollHeight||1); if(s>=0.75) markEngaged(); }, { passive:true });
    window.addEventListener('beforeunload', markBounce);
  })();
  
  // Display current UTM status
  (function() {
    function updateUtmDisplay() {
      const params = getParams();
      const utmDisplay = document.getElementById('utm-display');
      if (utmDisplay) {
        if (params.utm && Object.keys(params.utm).length > 0) {
          utmDisplay.innerHTML = '<span style="color: green;">âœ“ Active</span><br>' + 
            'Medium: <strong>' + (params.utm.medium || 'none') + '</strong><br>' +
            'Source: ' + (params.utm.source || 'none') + '<br>' +
            'Campaign: ' + (params.utm.campaign || 'none');
        } else {
          utmDisplay.innerHTML = '<span style="color: orange;">âš  No UTM params</span><br>Click a traffic source link above to test.';
        }
      }
    }
    // Update on page load
    setTimeout(updateUtmDisplay, 100);
    // Update when URL changes (for single-page navigation)
    window.addEventListener('popstate', updateUtmDisplay);
  })();
</script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="logo">DMwithAI Store</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1>Welcome to DMwithAI Demo Store ðŸš€</h1>
      <p class="subtitle">Testing Cohort Retention & Audience Segmentation</p>
      <p>This is a demo site to test the DMwithAI analytics modules. Navigate through different pages and interact with elements to generate tracking events.</p>
    </section>

    <section class="features">
      <h2>What You Can Test</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <h3>ðŸ“Š Cohort Retention</h3>
          <p>Track user retention over time by signup date, channel, and campaign.</p>
          <ul>
            <li>Signup detection from first session</li>
            <li>Retention at Day 1, 7, 14, 30</li>
            <li>Channel-based cohorts</li>
            <li>Campaign-based cohorts</li>
          </ul>
        </div>
        <div class="feature-card">
          <h3>ðŸŽ¯ Audience Segmentation</h3>
          <p>Identify high-performing audience segments by behavior and demographics.</p>
          <ul>
            <li>New vs Returning visitors</li>
            <li>Channel segmentation</li>
            <li>Engagement-based segments</li>
            <li>Conversion rate analysis</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="traffic-sources">
      <h2>Test Different Traffic Sources</h2>
      <p>Click these links to simulate different acquisition channels:</p>
      <div class="traffic-links">
        <a href="index.html?utm_source=google&utm_medium=organic&utm_campaign=seo" class="traffic-link organic">Organic Search</a>
        <a href="index.html?utm_source=google&utm_medium=cpc&utm_campaign=summer_sale" class="traffic-link paid">Paid Search (CPC)</a>
        <a href="index.html?utm_source=facebook&utm_medium=social&utm_campaign=brand_awareness" class="traffic-link social">Social Media</a>
        <a href="index.html" class="traffic-link direct">Direct Traffic</a>
      </div>
      <div id="utm-status" style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px; font-family: monospace; font-size: 12px;">
        <strong>Current UTM Status:</strong> <span id="utm-display">Loading...</span>
      </div>
    </section>

    <section class="actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <a href="products.html" class="btn btn-primary">Browse Products</a>
        <a href="contact.html" class="btn btn-secondary">Contact Us</a>
        <button onclick="sendEvent('conversion', {goal: 'newsletter_signup', value: 0})" class="btn btn-success">Sign Up for Newsletter</button>
      </div>
    </section>

    <section class="info">
      <h2>Tracking Events</h2>
      <p>The following events are automatically tracked:</p>
      <ul>
        <li><strong>pageview</strong> - On every page load</li>
        <li><strong>engaged</strong> - After 30 seconds or 75% scroll</li>
        <li><strong>bounce</strong> - On quick exit without engagement</li>
        <li><strong>conversion</strong> - On button clicks (newsletter, purchase, etc.)</li>
      </ul>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 DMwithAI Demo Store. Built for testing analytics modules.</p>
    </div>
  </footer>
</body>
</html>

