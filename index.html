<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DMwithAI Demo Store - Home</title>
  <link rel="stylesheet" href="styles.css">
<!-- Google tag (gtag.js) -->
<script>
  (function() {
    var SURVEY_ID = "87f5fc72-c161-4c98-90a7-4b6baa7e50b3";
    var EXP_DAYS = 7;
    var SURVEY_APP_BASE = "https://0328-41-90-186-108.ngrok-free.app";
    var AUTO_TRIGGER = true;
    var AUTO_DELAY_MS = 20000;
    var COOLDOWN_DAYS = 7;
    var sid = (function() {
      try {
        return localStorage.getItem("_our_sid") || "";
      } catch (e) {
        return "";
      }
    })();
    var userKey = (window.DMWIdentity && (window.DMWIdentity.user_key || window.DMWIdentity.user_id)) || "";

    function openSurvey(opts) {
      var usePopup = opts && opts.popup;
      fetch("https://6e3e-41-90-186-108.ngrok-free.app/api/surveys/public/" + SURVEY_ID + "/session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sid: sid, user_key: userKey, exp_days: EXP_DAYS })
      })
        .then(function(res) { return res.json(); })
        .then(function(data) {
          if (!data.survey_token) return;
          var url = SURVEY_APP_BASE + "/surveys/public/" + SURVEY_ID + "?st=" + encodeURIComponent(data.survey_token) + "&origin=website";
          if (usePopup) {
            window.open(url, "_blank");
          } else {
            window.location.href = url;
          }
        });
    }

    // Example trigger: call openSurvey() on a button click
    window.DMWSurveyOpen = function() { return openSurvey({ popup: true }); };

    // Auto-trigger (optional, once per cooldown)
    if (AUTO_TRIGGER) {
      var shownKey = "survey_shown_" + SURVEY_ID;
      var lastShown = parseInt(localStorage.getItem(shownKey) || "0", 10);
      var cooldownMs = COOLDOWN_DAYS * 24 * 60 * 60 * 1000;
      if (Date.now() - lastShown > cooldownMs) {
        setTimeout(function() {
          openSurvey({ popup: false });
          localStorage.setItem(shownKey, Date.now().toString());
        }, AUTO_DELAY_MS);
      }
    }
  })();
</script>
<script src="tracking-snippet.js"></script>
<script
  src="http://localhost:8001/api/ab-runtime.js"
  data-api-base="http://localhost:8001"
  data-site-token="C23bLSndtg3N_K7EmrOFk_k4LnNGVzkX"
  data-experiment-id="1"
  data-surface="landing_page"
  data-copy-selector="[data-dmw-copy]"
  async
></script>
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="logo">DMwithAI Store</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1 data-dmw-copy>Welcome to DMwithAI Demo Store 22 ðŸš€</h1>
      <p class="subtitle">Testing Cohort Retention & Audience Segmentation</p>
      <p>This is a demo site to test the DMwithAI analytics modules. Navigate through different pages and interact with elements to generate tracking events.</p>
    </section>

    <section class="features">
      <h2>What You Can Test</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <h3>ðŸ“Š Cohort Retention</h3>
          <p>Track user retention over time by signup date, channel, and campaign.</p>
          <ul>
            <li>Signup detection from first session</li>
            <li>Retention at Day 1, 7, 14, 30</li>
            <li>Channel-based cohorts</li>
            <li>Campaign-based cohorts</li>
          </ul>
        </div>
        <div class="feature-card">
          <h3>ðŸŽ¯ Audience Segmentation</h3>
          <p>Identify high-performing audience segments by behavior and demographics.</p>
          <ul>
            <li>New vs Returning visitors</li>
            <li>Channel segmentation</li>
            <li>Engagement-based segments</li>
            <li>Conversion rate analysis</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="traffic-sources">
      <h2>Test Different Traffic Sources</h2>
      <p>Click these links to simulate different acquisition channels:</p>
      <div class="traffic-links">
        <button onclick="sendEvent('pageview', {utm: {source: 'google', medium: 'organic', campaign: 'seo'}}); alert('âœ… Organic UTM event sent! Check /debug/last-event endpoint');" class="traffic-link organic" style="border: none; cursor: pointer; width: 100%;">Organic Search (Test)</button>
        <button onclick="sendEvent('pageview', {utm: {source: 'google', medium: 'cpc', campaign: 'summer_sale'}}); alert('âœ… Paid UTM event sent! Check /debug/last-event endpoint');" class="traffic-link paid" style="border: none; cursor: pointer; width: 100%;">Paid Search (Test)</button>
        <button onclick="const utmData = {utm: {source: 'facebook', medium: 'social', campaign: 'brand_awareness'}}; console.log('ðŸ” Sending social UTM:', utmData); sendEvent('pageview', utmData); alert('âœ… Social UTM event sent! Check /debug/last-event endpoint');" class="traffic-link social" style="border: none; cursor: pointer; width: 100%;">Social Media (Test)</button>
        <button onclick="sendEvent('pageview', {}); alert('âœ… Direct traffic event sent!');" class="traffic-link direct" style="border: none; cursor: pointer; width: 100%;">Direct Traffic (Test)</button>
      </div>
      <p style="margin-top: 15px; font-size: 14px; color: #666;">
        <strong>Note:</strong> GitHub Pages strips query parameters via redirects. On a real site, UTM parameters will work normally. 
        The test buttons above send UTM params directly in the event payload for testing purposes. They don't reload the page.
      </p>
      <p style="margin-top: 10px; font-size: 12px; color: #999;">
        After clicking a test button, check: <code>https://dmwithai.selftrainai.com/api/collector/debug/last-event</code>
      </p>
    </section>

    <section class="actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <a href="products.html" class="btn btn-primary">Browse Products</a>
        <a href="contact.html" class="btn btn-secondary">Contact Us</a>
        <button onclick="sendEvent('conversion', {goal: 'newsletter_signup', value: 0})" class="btn btn-success">Sign Up for Newsletter</button>
      </div>
    </section>

    <section class="info">
      <h2>Tracking Events</h2>
      <p>The following events are automatically tracked:</p>
      <ul>
        <li><strong>pageview</strong> - On every page load</li>
        <li><strong>engaged</strong> - After 30 seconds or 75% scroll</li>
        <li><strong>bounce</strong> - On quick exit without engagement</li>
        <li><strong>conversion</strong> - On button clicks (newsletter, purchase, etc.)</li>
      </ul>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 DMwithAI Demo Store. Built for testing analytics modules.</p>
    </div>
  </footer>
</body>
</html>
